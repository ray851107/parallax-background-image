var parallax=(()=>{var d=Object.defineProperty;var y=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var E=(r,t,e)=>t in r?d(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,u=(r,t)=>{for(var e in t||(t={}))W.call(t,e)&&E(r,e,t[e]);if(y)for(var e of y(t))C.call(t,e)&&E(r,e,t[e]);return r};var P=r=>d(r,"__esModule",{value:!0});var j=(r,t)=>{P(r);for(var e in t)d(r,e,{get:t[e],enumerable:!0})};var J={};j(J,{ImageElementRenderer:()=>h,PseudoElementRenderer:()=>f,createViewport:()=>G});function _(r=""){let t=S(r);return document.head.appendChild(t),t.sheet}function w(r=""){let t=S(r);return document.head.insertBefore(t,document.head.firstElementChild),t.sheet}function S(r){let t=document.createElement("style");return t.appendChild(document.createTextNode(r)),t}var c="parallax-background-image-viewport",m="parallax-background-image-viewport-3d",l="parallax-background-image-element";function R(){w(X)}var X=`
.${l} {
  position: relative;
  overflow: hidden !important;
  background: none !important;
  background-image: none !important;
}

.${l} > * {
  position: relative;
}

.${c} {
  overflow-x: hidden !important;
  overflow-y: scroll !important;
  -webkit-overflow-scrolling: touch;
}

.${m} {
  perspective: 1px !important;
  perspective-origin: center center !important;
}`;function A(r){let t=r.use3d?I:T,e=k(r.velocity),i=z(r.alignX),n=t(r.velocity);return function(s,o,a){e(s,o,a),i(s,o,a),n(s,o,a)}}function L(r,t){r.x*=t,r.y*=t,r.z*=t,r.w*=t,r.h*=t}function k(r){return function(e,i,n){let x=i.w,s=n.h+r*(n.h-i.h),o=x/e.w,a=s/e.h;L(e,Math.max(o,a))}}function z(r){return r=H(r),function(e,i,n){e.x=(.5-r)*(e.w-i.w)}}function H(r){if(r==="left")return 0;if(r==="center")return .5;if(r==="right")return 1;let t=parseFloat(r);return isNaN(t)?.5:t/100}function I(r){return function(e,i,n){L(e,1/r),e.z+=1-1/r,e.x-=i.x*(1-1/r)}}function T(r){return function(e,i,n){e.y+=i.y*(r-1)}}var p=class{constructor(t,e,i){this.element=t,this.imageWidth=e.naturalWidth,this.imageHeight=e.naturalHeight,this.transform_=A(i),this.renderer=new i.renderer(t,e,i),this.bgRect={x:NaN,y:NaN,z:NaN,w:NaN,h:NaN},this.dirty=!1,this.disposed=!1,this.element.classList.add(l)}updateRect(t,e){if(this.disposed)return;let i={x:0,y:0,z:0,w:this.imageWidth,h:this.imageHeight};this.transform_(i,t,e),O(this.bgRect,i)&&(this.dirty=!0,q(this.bgRect,i))}render(){this.disposed||!this.dirty||(this.dirty=!1,this.renderer.render(this.bgRect))}dispose(){this.disposed||(this.disposed=!0,this.element.classList.remove(l),this.renderer.dispose())}};function O(r,t){return r.x!==t.x||r.y!==t.y||r.z!==t.z||r.w!==t.w||r.h!==t.h}function q(r,t){r.x=t.x,r.y=t.y,r.z=t.z,r.w=t.w,r.h=t.h}function v(r,t,e){r.position="absolute",r.left="50%",r.top="50%",r.width=`${t}px`,r.height=`${e}px`,r.transformOrigin="center center 0",r.pointerEvents="none"}function N(r,t,e,i){r.transform=`translateX(${t.x-e/2}px)translateY(${t.y-i/2}px)translateZ(${t.z}px)scale(${t.w/e}, ${t.h/i})`}var h=class{constructor(t,e,i){this.element=t,this.imageWidth=e.naturalWidth,this.imageHeight=e.naturalHeight,this.img=document.createElement("img"),this.style=this.img.style,this.disposed=!1,window.requestAnimationFrame(()=>{this.disposed||(this.img.src=e.src,v(this.style,this.imageWidth,this.imageHeight),this.element.prepend(this.img))})}render(t){this.disposed||N(this.style,t,this.imageWidth,this.imageHeight)}dispose(){this.disposed||(this.disposed=!0,this.element.removeChild(this.img))}};function V(r,t){let e=`${r} {}`,i=t.insertRule(e,0);return t.cssRules[i].style}var F=_(),B=0,f=class{constructor(t,e,i){this.element=t,this.imageWidth=e.naturalWidth,this.imageHeight=e.naturalHeight;let n=B++;this.className=`parallax-background-image-pseudo-${n}`,this.style=V(`.${this.className}::before`,F),this.disposed=!1,window.requestAnimationFrame(()=>{this.disposed||(this.style.content='""',this.style.backgroundImage=`url(${e.src})`,this.style.backgroundSize="100% 100%",v(this.style,this.imageWidth,this.imageHeight),this.element.classList.add(this.className))})}render(t){this.disposed||N(this.style,t,this.imageWidth,this.imageHeight)}dispose(){this.disposed||(this.disposed=!0,this.element.classList.remove(this.className))}};var g=class{constructor(t,e){typeof t=="string"&&(t=document.querySelector(t)),e=u({use3d:M()},e),this.rootElement=t,this.options=e,this.parallaxElements=[],this._setupStyle(),this._monitorRects(),this._startRenderLoop()}_setupStyle(){this.rootElement.classList.add(c),this.options.use3d&&this.rootElement.classList.add(m)}_monitorRects(){let t=this._updateRects.bind(this);window.addEventListener("resize",t),this.options.use3d||this.rootElement.addEventListener("scroll",t)}_updateRects(){let t=this.parallaxElements,e=$(this.rootElement);for(let i=0;i<t.length;++i){let n=$(t[i].element);D(n,e),t[i].updateRect(n,e)}}_startRenderLoop(){let t=this.parallaxElements;function e(){for(let i=0;i<t.length;++i)t[i].render();window.requestAnimationFrame(e)}window.requestAnimationFrame(e)}add(t,e={}){if(t instanceof Element){this._addElement(t,e);return}typeof t=="string"&&(t=this.rootElement.querySelectorAll(t));for(let i=0;i<t.length;++i)this._addElement(t[i],e)}_addElement(t,e){!this._isViewportFor(t)||(this._removeElement(t),e=this._parseElementOptions(t,e),e.image!=null&&Z(e.image,(i,n)=>{i||(this.parallaxElements.push(new p(t,n,e)),this._updateRects())}))}_isViewportFor(t){return t!==this.rootElement&&t.closest(`.${c}`)===this.rootElement}_parseElementOptions(t,e){return typeof e=="function"&&(e=e(t)),e=u({velocity:.8,alignX:"center",renderer:h},e),e.image==null&&(e.image=Y(t)),e.use3d=this.options.use3d,e}remove(t){if(t instanceof Element){this._removeElement(t);return}typeof t=="string"&&(t=this.rootElement.querySelectorAll(t));for(let e=0;e<t.length;++e)this._removeElement(t[e])}_removeElement(t){let e=this.parallaxElements;for(let i=0;i<e.length;++i)if(this.parallaxElements[i].element===t){e[i].dispose(),e.splice(i,1);return}}};function M(){let r=navigator.userAgent;return r.indexOf("Chrome/")!==-1&&r.indexOf("Edge/")===-1}function $(r){let t=r.getBoundingClientRect();return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2,w:t.right-t.left,h:t.bottom-t.top}}function D(r,t){r.x-=t.x,r.y-=t.y}function Y(r){let t=window.getComputedStyle(r),e=/^url\((['"]?)(.*)\1\)$/.exec(t.backgroundImage);return e==null?null:e[2]}function Z(r,t){let e=document.createElement("img");e.onload=function(i){t(null,i.target)},e.onerror=function(i){t(i.error)},e.src=r}R();function G(r,t={}){return new g(r,t)}return J;})();
//# sourceMappingURL=parallax-background-image.js.map
