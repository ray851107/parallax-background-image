{"version":3,"file":"parallax-background-image.modern.js","sources":["../src/style-sheet.js","../src/transform.js","../src/parallax-element.js","../src/style.js","../src/renderer.js","../src/parallax-viewport.js","../src/main.js"],"sourcesContent":["export function appendStyleSheet(content = \"\") {\n  const style = createStyleElement(content);\n  document.head.appendChild(style);\n  return style.sheet;\n}\n\nexport function prependStyleSheet(content = \"\") {\n  const style = createStyleElement(content);\n  document.head.insertBefore(style, document.head.firstElementChild);\n  return style.sheet;\n}\n\nfunction createStyleElement(content) {\n  const style = document.createElement(\"style\");\n  style.appendChild(document.createTextNode(content));\n  return style;\n}\n","export function createTransform(options) {\n  const parallax = options.use3d ? parallax3d : parallax2d;\n\n  const coverElement_ = coverElement(options.velocity);\n  const alignX_ = alignX(options.alignX);\n  const parallax_ = parallax(options.velocity);\n\n  return function transform_(bg, element, viewport) {\n    coverElement_(bg, element, viewport);\n    alignX_(bg, element, viewport);\n    parallax_(bg, element, viewport);\n  };\n}\n\nfunction scale_(bg, s) {\n  bg.x *= s;\n  bg.y *= s;\n  bg.z *= s;\n  bg.w *= s;\n  bg.h *= s;\n}\n\nfunction coverElement(velocity) {\n  return function coverElement_(bg, element, viewport) {\n    const minWidth = element.w;\n    const minHeight = viewport.h + velocity * (viewport.h - element.h);\n    const widthScale = minWidth / bg.w;\n    const heightScale = minHeight / bg.h;\n\n    scale_(bg, Math.max(widthScale, heightScale));\n  };\n}\n\nfunction alignX(percentage) {\n  percentage = parsePercentage(percentage);\n  return function alignX_(bg, element, viewport) {\n    bg.x = (0.5 - percentage) * (bg.w - element.w);\n  };\n}\n\nfunction parsePercentage(str) {\n  if (str === \"left\") return 0;\n  if (str === \"center\") return 0.5;\n  if (str === \"right\") return 1;\n  const num = parseFloat(str);\n  if (!isNaN(num)) return num / 100;\n  return 0.5;\n}\n\nfunction parallax3d(velocity) {\n  return function parallax3d_(bg, element, viewport) {\n    scale_(bg, 1 / velocity);\n    bg.z += 1 - 1 / velocity;\n    bg.x -= element.x * (1 - 1 / velocity);\n  };\n}\n\nfunction parallax2d(velocity) {\n  return function parallax2d_(bg, element, viewport) {\n    bg.y += element.y * (velocity - 1);\n  };\n}\n","import { CLASS_PARALLAX_ELEMENT } from \"./style\";\nimport { createTransform } from \"./transform\";\n\nexport class ParallaxElement {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    this.transform_ = createTransform(options);\n    this.renderer = new options.renderer(element, image, options);\n\n    this.bgRect = { x: NaN, y: NaN, z: NaN, w: NaN, h: NaN };\n    this.dirty = false;\n\n    this.disposed = false;\n\n    this.element.classList.add(CLASS_PARALLAX_ELEMENT);\n  }\n\n  updateRect(elementRect, viewportRect) {\n    if (this.disposed) return;\n    const bgRect = {\n      x: 0,\n      y: 0,\n      z: 0,\n      w: this.imageWidth,\n      h: this.imageHeight\n    };\n    this.transform_(bgRect, elementRect, viewportRect);\n    if (notEqual(this.bgRect, bgRect)) {\n      this.dirty = true;\n      copy_(this.bgRect, bgRect);\n    }\n  }\n\n  render() {\n    if (this.disposed) return;\n    if (!this.dirty) return;\n    this.dirty = false;\n    this.renderer.render(this.bgRect);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.classList.remove(CLASS_PARALLAX_ELEMENT);\n    this.renderer.dispose();\n  }\n}\n\nfunction notEqual(a, b) {\n  return (\n    a.x !== b.x || a.y !== b.y || a.z !== b.z || a.w !== b.w || a.h !== b.h\n  );\n}\n\nfunction copy_(a, b) {\n  a.x = b.x;\n  a.y = b.y;\n  a.z = b.z;\n  a.w = b.w;\n  a.h = b.h;\n}\n","import { prependStyleSheet } from \"./style-sheet\";\n\nexport const CLASS_PARALLAX_VIEWPORT = \"parallax-background-image-viewport\";\nexport const CLASS_PARALLAX_VIEWPORT_3D =\n  \"parallax-background-image-viewport-3d\";\nexport const CLASS_PARALLAX_ELEMENT = \"parallax-background-image-element\";\n\nexport function injectStyle() {\n  prependStyleSheet(STYLE);\n}\n\nconst STYLE = `\n.${CLASS_PARALLAX_ELEMENT} {\n  position: relative;\n  overflow: hidden !important;\n  background: none !important;\n  background-image: none !important;\n}\n\n.${CLASS_PARALLAX_ELEMENT} > * {\n  position: relative;\n}\n\n.${CLASS_PARALLAX_VIEWPORT} {\n  overflow-x: hidden !important;\n  overflow-y: scroll !important;\n  -webkit-overflow-scrolling: touch;\n}\n\n.${CLASS_PARALLAX_VIEWPORT_3D} {\n  perspective: 1px !important;\n  perspective-origin: center center !important;\n}`;\n","import { appendStyleSheet } from \"./style-sheet\";\n\nfunction setupStyle(style, width, height) {\n  style.position = \"absolute\";\n  style.left = \"50%\";\n  style.top = \"50%\";\n  style.width = `${width}px`;\n  style.height = `${height}px`;\n  style.transformOrigin = \"center center 0\";\n  style.pointerEvents = \"none\";\n}\n\nfunction renderToStyle(style, bg, imageWidth, imageHeight) {\n  style.transform =\n    `translateX(${bg.x - imageWidth / 2}px)` +\n    `translateY(${bg.y - imageHeight / 2}px)` +\n    `translateZ(${bg.z}px)` +\n    `scale(${bg.w / imageWidth}, ${bg.h / imageHeight})`;\n}\n\nexport class ImageElementRenderer {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    this.img = document.createElement(\"img\");\n    this.style = this.img.style;\n\n    this.disposed = false;\n\n    window.requestAnimationFrame(() => {\n      if (this.disposed) return;\n      this.img.src = image.src;\n      setupStyle(this.style, this.imageWidth, this.imageHeight);\n      this.element.prepend(this.img);\n    });\n  }\n\n  render(bg) {\n    if (this.disposed) return;\n    renderToStyle(this.style, bg, this.imageWidth, this.imageHeight);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.removeChild(this.img);\n  }\n}\n\nfunction createStyle(selector, styleSheet) {\n  const rule = `${selector} {}`;\n  const index = styleSheet.insertRule(rule, 0);\n  return styleSheet.cssRules[index].style;\n}\n\nconst styleSheet = appendStyleSheet();\nlet nextId = 0;\nexport class PseudoElementRenderer {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    const id = nextId++;\n    this.className = `parallax-background-image-pseudo-${id}`;\n\n    this.style = createStyle(`.${this.className}::before`, styleSheet);\n\n    this.disposed = false;\n\n    window.requestAnimationFrame(() => {\n      if (this.disposed) return;\n      this.style.content = '\"\"';\n      this.style.backgroundImage = `url(${image.src})`;\n      this.style.backgroundSize = \"100% 100%\";\n      setupStyle(this.style, this.imageWidth, this.imageHeight);\n      this.element.classList.add(this.className);\n    });\n  }\n\n  render(bg) {\n    if (this.disposed) return;\n    renderToStyle(this.style, bg, this.imageWidth, this.imageHeight);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.classList.remove(this.className);\n  }\n}\n","import { CLASS_PARALLAX_VIEWPORT, CLASS_PARALLAX_VIEWPORT_3D } from \"./style\";\nimport { ParallaxElement } from \"./parallax-element\";\nimport { ImageElementRenderer } from \"./renderer\";\n\nexport class ParallaxViewport {\n  constructor(rootElement, options) {\n    if (typeof rootElement === \"string\") {\n      rootElement = document.querySelector(rootElement);\n    }\n\n    options = {\n      use3d: isChrome(),\n      ...options\n    };\n\n    this.rootElement = rootElement;\n    this.options = options;\n    this.parallaxElements = [];\n\n    this._setupStyle();\n    this._monitorRects();\n    this._startRenderLoop();\n  }\n\n  _setupStyle() {\n    this.rootElement.classList.add(CLASS_PARALLAX_VIEWPORT);\n    if (this.options.use3d) {\n      this.rootElement.classList.add(CLASS_PARALLAX_VIEWPORT_3D);\n    }\n  }\n\n  _monitorRects() {\n    const _updateRects = this._updateRects.bind(this);\n    window.addEventListener(\"resize\", _updateRects);\n    if (!this.options.use3d) {\n      this.rootElement.addEventListener(\"scroll\", _updateRects);\n    }\n  }\n\n  _updateRects() {\n    const parallaxElements = this.parallaxElements;\n    const viewportRect = getRect(this.rootElement);\n    for (let i = 0; i < parallaxElements.length; ++i) {\n      const elementRect = getRect(parallaxElements[i].element);\n      subtract_(elementRect, viewportRect);\n      parallaxElements[i].updateRect(elementRect, viewportRect);\n    }\n  }\n\n  _startRenderLoop() {\n    const parallaxElements = this.parallaxElements;\n    function renderLoop() {\n      for (let i = 0; i < parallaxElements.length; ++i) {\n        parallaxElements[i].render();\n      }\n      window.requestAnimationFrame(renderLoop);\n    }\n    window.requestAnimationFrame(renderLoop);\n  }\n\n  add(elements, options = {}) {\n    if (elements instanceof Element) {\n      this._addElement(elements, options);\n      return;\n    }\n\n    if (typeof elements === \"string\") {\n      elements = this.rootElement.querySelectorAll(elements);\n    }\n\n    for (let i = 0; i < elements.length; ++i) {\n      this._addElement(elements[i], options);\n    }\n  }\n\n  _addElement(element, options) {\n    if (!this._isViewportFor(element)) return;\n    this._removeElement(element);\n\n    options = this._parseElementOptions(element, options);\n    if (options.image == null) return;\n\n    loadImage(options.image, (err, image) => {\n      if (err) return;\n      this.parallaxElements.push(new ParallaxElement(element, image, options));\n      this._updateRects();\n    });\n  }\n\n  _isViewportFor(element) {\n    return (\n      element !== this.rootElement &&\n      element.closest(`.${CLASS_PARALLAX_VIEWPORT}`) === this.rootElement\n    );\n  }\n\n  _parseElementOptions(element, options) {\n    if (typeof options === \"function\") {\n      options = options(element);\n    }\n\n    options = {\n      velocity: 0.8,\n      alignX: \"center\",\n      renderer: ImageElementRenderer,\n      ...options\n    };\n\n    if (options.image == null) {\n      options.image = cssBackgroundImage(element);\n    }\n\n    options.use3d = this.options.use3d;\n\n    return options;\n  }\n\n  remove(elements) {\n    if (elements instanceof Element) {\n      this._removeElement(elements);\n      return;\n    }\n\n    if (typeof elements === \"string\") {\n      elements = this.rootElement.querySelectorAll(elements);\n    }\n\n    for (let i = 0; i < elements.length; ++i) {\n      this._removeElement(elements[i]);\n    }\n  }\n\n  _removeElement(element) {\n    const parallaxElements = this.parallaxElements;\n    for (let i = 0; i < parallaxElements.length; ++i) {\n      if (this.parallaxElements[i].element === element) {\n        parallaxElements[i].dispose();\n        parallaxElements.splice(i, 1);\n        return;\n      }\n    }\n  }\n}\n\nfunction isChrome() {\n  const userAgent = navigator.userAgent;\n  return (\n    userAgent.indexOf(\"Chrome/\") !== -1 && userAgent.indexOf(\"Edge/\") === -1\n  );\n}\n\nfunction getRect(element) {\n  const rect = element.getBoundingClientRect();\n  return {\n    x: (rect.left + rect.right) / 2,\n    y: (rect.top + rect.bottom) / 2,\n    w: rect.right - rect.left,\n    h: rect.bottom - rect.top\n  };\n}\n\nfunction subtract_(a, b) {\n  a.x -= b.x;\n  a.y -= b.y;\n}\n\nfunction cssBackgroundImage(element) {\n  const style = window.getComputedStyle(element);\n  const match = /^url\\((['\"]?)(.*)\\1\\)$/.exec(style.backgroundImage);\n  return match == null ? null : match[2];\n}\n\nfunction loadImage(src, cb) {\n  const image = document.createElement(\"img\");\n  image.onload = function(event) {\n    cb(null, event.target);\n  };\n  image.onerror = function(event) {\n    cb(event.error);\n  };\n  image.src = src;\n}\n","import { ParallaxViewport } from \"./parallax-viewport\";\nimport { ImageElementRenderer, PseudoElementRenderer } from \"./renderer.js\";\nimport { injectStyle } from \"./style.js\";\n\ninjectStyle();\n\nexport function createViewport(rootElement, options = {}) {\n  return new ParallaxViewport(rootElement, options);\n}\n\nexport { ImageElementRenderer, PseudoElementRenderer };\n"],"names":["createStyleElement","content","style","document","createElement","appendChild","createTextNode","scale_","bg","s","x","y","z","w","h","parallax3d","velocity","element","viewport","parallax2d","ParallaxElement","constructor","image","options","this","imageWidth","naturalWidth","imageHeight","naturalHeight","transform_","parallax","use3d","coverElement_","Math","max","alignX_","percentage","str","num","parseFloat","isNaN","parsePercentage","alignX","parallax_","createTransform","renderer","bgRect","NaN","dirty","disposed","classList","add","updateRect","elementRect","viewportRect","a","b","copy_","render","dispose","remove","setupStyle","width","height","position","left","top","transformOrigin","pointerEvents","renderToStyle","transform","ImageElementRenderer","img","window","requestAnimationFrame","src","prepend","removeChild","styleSheet","head","sheet","appendStyleSheet","nextId","PseudoElementRenderer","id","className","selector","index","insertRule","cssRules","createStyle","backgroundImage","backgroundSize","ParallaxViewport","rootElement","querySelector","isChrome","parallaxElements","_setupStyle","_monitorRects","_startRenderLoop","_updateRects","bind","addEventListener","getRect","i","length","renderLoop","elements","Element","_addElement","querySelectorAll","_isViewportFor","_removeElement","_parseElementOptions","cb","onload","event","target","onerror","error","loadImage","err","push","closest","getComputedStyle","match","exec","cssBackgroundImage","splice","userAgent","navigator","indexOf","rect","getBoundingClientRect","right","bottom","createViewport","insertBefore","firstElementChild","prependStyleSheet"],"mappings":"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"}