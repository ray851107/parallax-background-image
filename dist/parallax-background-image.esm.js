function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function t(e){var t=document.createElement("style");return t.appendChild(document.createTextNode(e)),t}function n(e,t){e.x*=t,e.y*=t,e.z*=t,e.w*=t,e.h*=t}function i(e){return function(t,i,r){n(t,1/e),t.z+=1-1/e,t.x-=i.x*(1-1/e)}}function r(e){return function(t,n,i){t.y+=n.y*(e-1)}}var o=function(){function e(e,t,o){this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight,this.transform_=function(e){var t,o,s=e.use3d?i:r,a=(t=e.velocity,function(e,i,r){n(e,Math.max(i.w/e.w,(r.h+t*(r.h-i.h))/e.h))}),l=(o=function(e){if("left"===e)return 0;if("center"===e)return.5;if("right"===e)return 1;var t=parseFloat(e);return isNaN(t)?.5:t/100}(o=e.alignX),function(e,t,n){e.x=(.5-o)*(e.w-t.w)}),d=s(e.velocity);return function(e,t,n){a(e,t,n),l(e,t,n),d(e,t,n)}}(o),this.renderer=new o.renderer(e,t,o),this.bgRect={x:NaN,y:NaN,z:NaN,w:NaN,h:NaN},this.dirty=!1,this.disposed=!1,this.element.classList.add("parallax-background-image-element")}var t=e.prototype;return t.updateRect=function(e,t){if(!this.disposed){var n,i,r={x:0,y:0,z:0,w:this.imageWidth,h:this.imageHeight};this.transform_(r,e,t),((n=this.bgRect).x!==(i=r).x||n.y!==i.y||n.z!==i.z||n.w!==i.w||n.h!==i.h)&&(this.dirty=!0,function(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.h=t.h}(this.bgRect,r))}},t.render=function(){this.disposed||this.dirty&&(this.dirty=!1,this.renderer.render(this.bgRect))},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.classList.remove("parallax-background-image-element"),this.renderer.dispose())},e}();function s(e,t,n){e.position="absolute",e.left="50%",e.top="50%",e.width=t+"px",e.height=n+"px",e.transformOrigin="center center 0",e.pointerEvents="none"}function a(e,t,n,i){e.transform="translateX("+(t.x-n/2)+"px)translateY("+(t.y-i/2)+"px)translateZ("+t.z+"px)scale("+t.w/n+", "+t.h/i+")"}var l=function(){function e(e,t,n){var i=this;this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight,this.img=document.createElement("img"),this.style=this.img.style,this.disposed=!1,window.requestAnimationFrame(function(){i.disposed||(i.img.src=t.src,s(i.style,i.imageWidth,i.imageHeight),i.element.prepend(i.img))})}var t=e.prototype;return t.render=function(e){this.disposed||a(this.style,e,this.imageWidth,this.imageHeight)},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.removeChild(this.img))},e}(),d=function(e){void 0===e&&(e="");var n=t(e);return document.head.appendChild(n),n.sheet}(),h=0,u=function(){function e(e,t,n){var i=this;this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight;var r=h++;this.className="parallax-background-image-pseudo-"+r,this.style=function(e,t){var n=t.insertRule(e+" {}",0);return t.cssRules[n].style}("."+this.className+"::before",d),this.disposed=!1,window.requestAnimationFrame(function(){i.disposed||(i.style.content='""',i.style.backgroundImage="url("+t.src+")",i.style.backgroundSize="100% 100%",s(i.style,i.imageWidth,i.imageHeight),i.element.classList.add(i.className))})}var t=e.prototype;return t.render=function(e){this.disposed||a(this.style,e,this.imageWidth,this.imageHeight)},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.classList.remove(this.className))},e}(),c=function(){function t(t,n){var i;"string"==typeof t&&(t=document.querySelector(t)),n=e({use3d:(i=navigator.userAgent,-1!==i.indexOf("Chrome/")&&-1===i.indexOf("Edge/"))},n),this.rootElement=t,this.options=n,this.parallaxElements=[],this._setupStyle(),this._monitorRects(),this._startRenderLoop()}var n=t.prototype;return n._setupStyle=function(){this.rootElement.classList.add("parallax-background-image-viewport"),this.options.use3d&&this.rootElement.classList.add("parallax-background-image-viewport-3d")},n._monitorRects=function(){var e=this._updateRects.bind(this);window.addEventListener("resize",e),this.options.use3d||this.rootElement.addEventListener("scroll",e)},n._updateRects=function(){for(var e=this.parallaxElements,t=m(this.rootElement),n=0;n<e.length;++n){var i=m(e[n].element);(r=i).x-=(o=t).x,r.y-=o.y,e[n].updateRect(i,t)}var r,o},n._startRenderLoop=function(){var e=this.parallaxElements;window.requestAnimationFrame(function t(){for(var n=0;n<e.length;++n)e[n].render();window.requestAnimationFrame(t)})},n.add=function(e,t){if(void 0===t&&(t={}),e instanceof Element)this._addElement(e,t);else{"string"==typeof e&&(e=this.rootElement.querySelectorAll(e));for(var n=0;n<e.length;++n)this._addElement(e[n],t)}},n._addElement=function(e,t){var n=this;this._isViewportFor(e)&&(this._removeElement(e),null!=(t=this._parseElementOptions(e,t)).image&&function(e,t){var n=document.createElement("img");n.onload=function(e){t(null,e.target)},n.onerror=function(e){t(e.error)},n.src=e}(t.image,function(i,r){i||(n.parallaxElements.push(new o(e,r,t)),n._updateRects())}))},n._isViewportFor=function(e){return e!==this.rootElement&&e.closest(".parallax-background-image-viewport")===this.rootElement},n._parseElementOptions=function(t,n){return"function"==typeof n&&(n=n(t)),null==(n=e({velocity:.8,alignX:"center",renderer:l},n)).image&&(n.image=function(e){var t=window.getComputedStyle(e),n=/^url\((['"]?)(.*)\1\)$/.exec(t.backgroundImage);return null==n?null:n[2]}(t)),n.use3d=this.options.use3d,n},n.remove=function(e){if(e instanceof Element)this._removeElement(e);else{"string"==typeof e&&(e=this.rootElement.querySelectorAll(e));for(var t=0;t<e.length;++t)this._removeElement(e[t])}},n._removeElement=function(e){for(var t=this.parallaxElements,n=0;n<t.length;++n)if(this.parallaxElements[n].element===e)return t[n].dispose(),void t.splice(n,1)},t}();function m(e){var t=e.getBoundingClientRect();return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2,w:t.right-t.left,h:t.bottom-t.top}}function p(e,t){return void 0===t&&(t={}),new c(e,t)}!function(e){void 0===e&&(e="");var n=t(e);document.head.insertBefore(n,document.head.firstElementChild)}("\n.parallax-background-image-element {\n  position: relative;\n  overflow: hidden !important;\n  background: none !important;\n  background-image: none !important;\n}\n\n.parallax-background-image-element > * {\n  position: relative;\n}\n\n.parallax-background-image-viewport {\n  overflow-x: hidden !important;\n  overflow-y: scroll !important;\n  -webkit-overflow-scrolling: touch;\n}\n\n.parallax-background-image-viewport-3d {\n  perspective: 1px !important;\n  perspective-origin: center center !important;\n}");export{l as ImageElementRenderer,u as PseudoElementRenderer,p as createViewport};
//# sourceMappingURL=parallax-background-image.esm.js.map
