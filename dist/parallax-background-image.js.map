{"version":3,"file":"parallax-background-image.js","sources":["../src/style-sheet.js","../src/transform.js","../src/parallax-element.js","../src/style.js","../src/renderer.js","../src/parallax-viewport.js","../src/main.js"],"sourcesContent":["export function appendStyleSheet(content = \"\") {\n  const style = createStyleElement(content);\n  document.head.appendChild(style);\n  return style.sheet;\n}\n\nexport function prependStyleSheet(content = \"\") {\n  const style = createStyleElement(content);\n  document.head.insertBefore(style, document.head.firstElementChild);\n  return style.sheet;\n}\n\nfunction createStyleElement(content) {\n  const style = document.createElement(\"style\");\n  style.appendChild(document.createTextNode(content));\n  return style;\n}\n","export function createTransform(options) {\n  const parallax = options.use3d ? parallax3d : parallax2d;\n\n  const coverElement_ = coverElement(options.velocity);\n  const alignX_ = alignX(options.alignX);\n  const parallax_ = parallax(options.velocity);\n\n  return function transform_(bg, element, viewport) {\n    coverElement_(bg, element, viewport);\n    alignX_(bg, element, viewport);\n    parallax_(bg, element, viewport);\n  };\n}\n\nfunction scale_(bg, s) {\n  bg.x *= s;\n  bg.y *= s;\n  bg.z *= s;\n  bg.w *= s;\n  bg.h *= s;\n}\n\nfunction coverElement(velocity) {\n  return function coverElement_(bg, element, viewport) {\n    const minWidth = element.w;\n    const minHeight = viewport.h + velocity * (viewport.h - element.h);\n    const widthScale = minWidth / bg.w;\n    const heightScale = minHeight / bg.h;\n\n    scale_(bg, Math.max(widthScale, heightScale));\n  };\n}\n\nfunction alignX(percentage) {\n  percentage = parsePercentage(percentage);\n  return function alignX_(bg, element, viewport) {\n    bg.x = (0.5 - percentage) * (bg.w - element.w);\n  };\n}\n\nfunction parsePercentage(str) {\n  if (str === \"left\") return 0;\n  if (str === \"center\") return 0.5;\n  if (str === \"right\") return 1;\n  const num = parseFloat(str);\n  if (!isNaN(num)) return num / 100;\n  return 0.5;\n}\n\nfunction parallax3d(velocity) {\n  return function parallax3d_(bg, element, viewport) {\n    scale_(bg, 1 / velocity);\n    bg.z += 1 - 1 / velocity;\n    bg.x -= element.x * (1 - 1 / velocity);\n  };\n}\n\nfunction parallax2d(velocity) {\n  return function parallax2d_(bg, element, viewport) {\n    bg.y += element.y * (velocity - 1);\n  };\n}\n","import { CLASS_PARALLAX_ELEMENT } from \"./style\";\nimport { createTransform } from \"./transform\";\n\nexport class ParallaxElement {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    this.transform_ = createTransform(options);\n    this.renderer = new options.renderer(element, image, options);\n\n    this.bgRect = { x: NaN, y: NaN, z: NaN, w: NaN, h: NaN };\n    this.dirty = false;\n\n    this.disposed = false;\n\n    this.element.classList.add(CLASS_PARALLAX_ELEMENT);\n  }\n\n  updateRect(elementRect, viewportRect) {\n    if (this.disposed) return;\n    const bgRect = {\n      x: 0,\n      y: 0,\n      z: 0,\n      w: this.imageWidth,\n      h: this.imageHeight\n    };\n    this.transform_(bgRect, elementRect, viewportRect);\n    if (notEqual(this.bgRect, bgRect)) {\n      this.dirty = true;\n      copy_(this.bgRect, bgRect);\n    }\n  }\n\n  render() {\n    if (this.disposed) return;\n    if (!this.dirty) return;\n    this.dirty = false;\n    this.renderer.render(this.bgRect);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.classList.remove(CLASS_PARALLAX_ELEMENT);\n    this.renderer.dispose();\n  }\n}\n\nfunction notEqual(a, b) {\n  return (\n    a.x !== b.x || a.y !== b.y || a.z !== b.z || a.w !== b.w || a.h !== b.h\n  );\n}\n\nfunction copy_(a, b) {\n  a.x = b.x;\n  a.y = b.y;\n  a.z = b.z;\n  a.w = b.w;\n  a.h = b.h;\n}\n","import { prependStyleSheet } from \"./style-sheet\";\n\nexport const CLASS_PARALLAX_VIEWPORT = \"parallax-background-image-viewport\";\nexport const CLASS_PARALLAX_VIEWPORT_3D =\n  \"parallax-background-image-viewport-3d\";\nexport const CLASS_PARALLAX_ELEMENT = \"parallax-background-image-element\";\n\nexport function injectStyle() {\n  prependStyleSheet(STYLE);\n}\n\nconst STYLE = `\n.${CLASS_PARALLAX_ELEMENT} {\n  position: relative;\n  overflow: hidden !important;\n  background: none !important;\n  background-image: none !important;\n}\n\n.${CLASS_PARALLAX_ELEMENT} > * {\n  position: relative;\n}\n\n.${CLASS_PARALLAX_VIEWPORT} {\n  overflow-x: hidden !important;\n  overflow-y: scroll !important;\n  -webkit-overflow-scrolling: touch;\n}\n\n.${CLASS_PARALLAX_VIEWPORT_3D} {\n  perspective: 1px !important;\n  perspective-origin: center center !important;\n}`;\n","import { appendStyleSheet } from \"./style-sheet\";\n\nfunction setupStyle(style, width, height) {\n  style.position = \"absolute\";\n  style.left = \"50%\";\n  style.top = \"50%\";\n  style.width = `${width}px`;\n  style.height = `${height}px`;\n  style.transformOrigin = \"center center 0\";\n  style.pointerEvents = \"none\";\n}\n\nfunction renderToStyle(style, bg, imageWidth, imageHeight) {\n  style.transform =\n    `translateX(${bg.x - imageWidth / 2}px)` +\n    `translateY(${bg.y - imageHeight / 2}px)` +\n    `translateZ(${bg.z}px)` +\n    `scale(${bg.w / imageWidth}, ${bg.h / imageHeight})`;\n}\n\nexport class ImageElementRenderer {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    this.img = document.createElement(\"img\");\n    this.style = this.img.style;\n\n    this.disposed = false;\n\n    window.requestAnimationFrame(() => {\n      if (this.disposed) return;\n      this.img.src = image.src;\n      setupStyle(this.style, this.imageWidth, this.imageHeight);\n      this.element.prepend(this.img);\n    });\n  }\n\n  render(bg) {\n    if (this.disposed) return;\n    renderToStyle(this.style, bg, this.imageWidth, this.imageHeight);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.removeChild(this.img);\n  }\n}\n\nfunction createStyle(selector, styleSheet) {\n  const rule = `${selector} {}`;\n  const index = styleSheet.insertRule(rule, 0);\n  return styleSheet.cssRules[index].style;\n}\n\nconst styleSheet = appendStyleSheet();\nlet nextId = 0;\nexport class PseudoElementRenderer {\n  constructor(element, image, options) {\n    this.element = element;\n    this.imageWidth = image.naturalWidth;\n    this.imageHeight = image.naturalHeight;\n\n    const id = nextId++;\n    this.className = `parallax-background-image-pseudo-${id}`;\n\n    this.style = createStyle(`.${this.className}::before`, styleSheet);\n\n    this.disposed = false;\n\n    window.requestAnimationFrame(() => {\n      if (this.disposed) return;\n      this.style.content = '\"\"';\n      this.style.backgroundImage = `url(${image.src})`;\n      this.style.backgroundSize = \"100% 100%\";\n      setupStyle(this.style, this.imageWidth, this.imageHeight);\n      this.element.classList.add(this.className);\n    });\n  }\n\n  render(bg) {\n    if (this.disposed) return;\n    renderToStyle(this.style, bg, this.imageWidth, this.imageHeight);\n  }\n\n  dispose() {\n    if (this.disposed) return;\n    this.disposed = true;\n    this.element.classList.remove(this.className);\n  }\n}\n","import { CLASS_PARALLAX_VIEWPORT, CLASS_PARALLAX_VIEWPORT_3D } from \"./style\";\nimport { ParallaxElement } from \"./parallax-element\";\nimport { ImageElementRenderer } from \"./renderer\";\n\nexport class ParallaxViewport {\n  constructor(rootElement, options) {\n    if (typeof rootElement === \"string\") {\n      rootElement = document.querySelector(rootElement);\n    }\n\n    options = {\n      use3d: isChrome(),\n      ...options\n    };\n\n    this.rootElement = rootElement;\n    this.options = options;\n    this.parallaxElements = [];\n\n    this._setupStyle();\n    this._monitorRects();\n    this._startRenderLoop();\n  }\n\n  _setupStyle() {\n    this.rootElement.classList.add(CLASS_PARALLAX_VIEWPORT);\n    if (this.options.use3d) {\n      this.rootElement.classList.add(CLASS_PARALLAX_VIEWPORT_3D);\n    }\n  }\n\n  _monitorRects() {\n    const _updateRects = this._updateRects.bind(this);\n    window.addEventListener(\"resize\", _updateRects);\n    if (!this.options.use3d) {\n      this.rootElement.addEventListener(\"scroll\", _updateRects);\n    }\n  }\n\n  _updateRects() {\n    const parallaxElements = this.parallaxElements;\n    const viewportRect = getRect(this.rootElement);\n    for (let i = 0; i < parallaxElements.length; ++i) {\n      const elementRect = getRect(parallaxElements[i].element);\n      subtract_(elementRect, viewportRect);\n      parallaxElements[i].updateRect(elementRect, viewportRect);\n    }\n  }\n\n  _startRenderLoop() {\n    const parallaxElements = this.parallaxElements;\n    function renderLoop() {\n      for (let i = 0; i < parallaxElements.length; ++i) {\n        parallaxElements[i].render();\n      }\n      window.requestAnimationFrame(renderLoop);\n    }\n    window.requestAnimationFrame(renderLoop);\n  }\n\n  add(elements, options = {}) {\n    if (elements instanceof Element) {\n      this._addElement(elements, options);\n      return;\n    }\n\n    if (typeof elements === \"string\") {\n      elements = this.rootElement.querySelectorAll(elements);\n    }\n\n    for (let i = 0; i < elements.length; ++i) {\n      this._addElement(elements[i], options);\n    }\n  }\n\n  _addElement(element, options) {\n    if (!this._isViewportFor(element)) return;\n    this._removeElement(element);\n\n    options = this._parseElementOptions(element, options);\n    if (options.image == null) return;\n\n    loadImage(options.image, (err, image) => {\n      if (err) return;\n      this.parallaxElements.push(new ParallaxElement(element, image, options));\n      this._updateRects();\n    });\n  }\n\n  _isViewportFor(element) {\n    return (\n      element !== this.rootElement &&\n      element.closest(`.${CLASS_PARALLAX_VIEWPORT}`) === this.rootElement\n    );\n  }\n\n  _parseElementOptions(element, options) {\n    if (typeof options === \"function\") {\n      options = options(element);\n    }\n\n    options = {\n      velocity: 0.8,\n      alignX: \"center\",\n      renderer: ImageElementRenderer,\n      ...options\n    };\n\n    if (options.image == null) {\n      options.image = cssBackgroundImage(element);\n    }\n\n    options.use3d = this.options.use3d;\n\n    return options;\n  }\n\n  remove(elements) {\n    if (elements instanceof Element) {\n      this._removeElement(elements);\n      return;\n    }\n\n    if (typeof elements === \"string\") {\n      elements = this.rootElement.querySelectorAll(elements);\n    }\n\n    for (let i = 0; i < elements.length; ++i) {\n      this._removeElement(elements[i]);\n    }\n  }\n\n  _removeElement(element) {\n    const parallaxElements = this.parallaxElements;\n    for (let i = 0; i < parallaxElements.length; ++i) {\n      if (this.parallaxElements[i].element === element) {\n        parallaxElements[i].dispose();\n        parallaxElements.splice(i, 1);\n        return;\n      }\n    }\n  }\n}\n\nfunction isChrome() {\n  const userAgent = navigator.userAgent;\n  return (\n    userAgent.indexOf(\"Chrome/\") !== -1 && userAgent.indexOf(\"Edge/\") === -1\n  );\n}\n\nfunction getRect(element) {\n  const rect = element.getBoundingClientRect();\n  return {\n    x: (rect.left + rect.right) / 2,\n    y: (rect.top + rect.bottom) / 2,\n    w: rect.right - rect.left,\n    h: rect.bottom - rect.top\n  };\n}\n\nfunction subtract_(a, b) {\n  a.x -= b.x;\n  a.y -= b.y;\n}\n\nfunction cssBackgroundImage(element) {\n  const style = window.getComputedStyle(element);\n  const match = /^url\\((['\"]?)(.*)\\1\\)$/.exec(style.backgroundImage);\n  return match == null ? null : match[2];\n}\n\nfunction loadImage(src, cb) {\n  const image = document.createElement(\"img\");\n  image.onload = function(event) {\n    cb(null, event.target);\n  };\n  image.onerror = function(event) {\n    cb(event.error);\n  };\n  image.src = src;\n}\n","import { ParallaxViewport } from \"./parallax-viewport\";\nimport { ImageElementRenderer, PseudoElementRenderer } from \"./renderer.js\";\nimport { injectStyle } from \"./style.js\";\n\ninjectStyle();\n\nexport function createViewport(rootElement, options = {}) {\n  return new ParallaxViewport(rootElement, options);\n}\n\nexport { ImageElementRenderer, PseudoElementRenderer };\n"],"names":["createStyleElement","content","style","document","createElement","appendChild","createTextNode","scale_","bg","s","x","y","z","w","h","parallax3d","velocity","element","viewport","parallax2d","ParallaxElement","image","options","this","imageWidth","naturalWidth","imageHeight","naturalHeight","transform_","percentage","parallax","use3d","coverElement_","Math","max","alignX_","str","num","parseFloat","isNaN","parsePercentage","alignX","parallax_","createTransform","renderer","bgRect","NaN","dirty","disposed","classList","add","updateRect","elementRect","viewportRect","a","b","copy_","render","dispose","remove","setupStyle","width","height","position","left","top","transformOrigin","pointerEvents","renderToStyle","transform","ImageElementRenderer","img","window","requestAnimationFrame","_this","src","prepend","removeChild","styleSheet","head","sheet","appendStyleSheet","nextId","PseudoElementRenderer","id","className","selector","index","insertRule","cssRules","createStyle","_this2","backgroundImage","backgroundSize","ParallaxViewport","rootElement","userAgent","querySelector","navigator","indexOf","parallaxElements","_setupStyle","_monitorRects","_startRenderLoop","_updateRects","bind","addEventListener","getRect","i","length","renderLoop","elements","Element","_addElement","querySelectorAll","_isViewportFor","_removeElement","_parseElementOptions","cb","onload","event","target","onerror","error","loadImage","err","push","closest","getComputedStyle","match","exec","cssBackgroundImage","splice","rect","getBoundingClientRect","right","bottom","insertBefore","firstElementChild","prependStyleSheet"],"mappings":"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"}