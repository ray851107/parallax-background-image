!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).parallax={})}(this,function(e){function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function n(e){var t=document.createElement("style");return t.appendChild(document.createTextNode(e)),t}function i(e,t){e.x*=t,e.y*=t,e.z*=t,e.w*=t,e.h*=t}function r(e){return function(t,n,r){i(t,1/e),t.z+=1-1/e,t.x-=n.x*(1-1/e)}}function o(e){return function(t,n,i){t.y+=n.y*(e-1)}}var s=function(){function e(e,t,n){this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight,this.transform_=function(e){var t,n,s=e.use3d?r:o,a=(t=e.velocity,function(e,n,r){i(e,Math.max(n.w/e.w,(r.h+t*(r.h-n.h))/e.h))}),l=(n=function(e){if("left"===e)return 0;if("center"===e)return.5;if("right"===e)return 1;var t=parseFloat(e);return isNaN(t)?.5:t/100}(n=e.alignX),function(e,t,i){e.x=(.5-n)*(e.w-t.w)}),d=s(e.velocity);return function(e,t,n){a(e,t,n),l(e,t,n),d(e,t,n)}}(n),this.renderer=new n.renderer(e,t,n),this.bgRect={x:NaN,y:NaN,z:NaN,w:NaN,h:NaN},this.dirty=!1,this.disposed=!1,this.element.classList.add("parallax-background-image-element")}var t=e.prototype;return t.updateRect=function(e,t){if(!this.disposed){var n,i,r={x:0,y:0,z:0,w:this.imageWidth,h:this.imageHeight};this.transform_(r,e,t),((n=this.bgRect).x!==(i=r).x||n.y!==i.y||n.z!==i.z||n.w!==i.w||n.h!==i.h)&&(this.dirty=!0,function(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.h=t.h}(this.bgRect,r))}},t.render=function(){this.disposed||this.dirty&&(this.dirty=!1,this.renderer.render(this.bgRect))},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.classList.remove("parallax-background-image-element"),this.renderer.dispose())},e}();function a(e,t,n){e.position="absolute",e.left="50%",e.top="50%",e.width=t+"px",e.height=n+"px",e.transformOrigin="center center 0",e.pointerEvents="none"}function l(e,t,n,i){e.transform="translateX("+(t.x-n/2)+"px)translateY("+(t.y-i/2)+"px)translateZ("+t.z+"px)scale("+t.w/n+", "+t.h/i+")"}var d=function(){function e(e,t,n){var i=this;this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight,this.img=document.createElement("img"),this.style=this.img.style,this.disposed=!1,window.requestAnimationFrame(function(){i.disposed||(i.img.src=t.src,a(i.style,i.imageWidth,i.imageHeight),i.element.prepend(i.img))})}var t=e.prototype;return t.render=function(e){this.disposed||l(this.style,e,this.imageWidth,this.imageHeight)},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.removeChild(this.img))},e}(),h=function(e){void 0===e&&(e="");var t=n(e);return document.head.appendChild(t),t.sheet}(),u=0,c=function(){function e(e,t,n){var i=this;this.element=e,this.imageWidth=t.naturalWidth,this.imageHeight=t.naturalHeight;var r=u++;this.className="parallax-background-image-pseudo-"+r,this.style=function(e,t){var n=t.insertRule(e+" {}",0);return t.cssRules[n].style}("."+this.className+"::before",h),this.disposed=!1,window.requestAnimationFrame(function(){i.disposed||(i.style.content='""',i.style.backgroundImage="url("+t.src+")",i.style.backgroundSize="100% 100%",a(i.style,i.imageWidth,i.imageHeight),i.element.classList.add(i.className))})}var t=e.prototype;return t.render=function(e){this.disposed||l(this.style,e,this.imageWidth,this.imageHeight)},t.dispose=function(){this.disposed||(this.disposed=!0,this.element.classList.remove(this.className))},e}(),m=function(){function e(e,n){var i;"string"==typeof e&&(e=document.querySelector(e)),n=t({use3d:(i=navigator.userAgent,-1!==i.indexOf("Chrome/")&&-1===i.indexOf("Edge/"))},n),this.rootElement=e,this.options=n,this.parallaxElements=[],this._setupStyle(),this._monitorRects(),this._startRenderLoop()}var n=e.prototype;return n._setupStyle=function(){this.rootElement.classList.add("parallax-background-image-viewport"),this.options.use3d&&this.rootElement.classList.add("parallax-background-image-viewport-3d")},n._monitorRects=function(){var e=this._updateRects.bind(this);window.addEventListener("resize",e),this.options.use3d||this.rootElement.addEventListener("scroll",e)},n._updateRects=function(){for(var e=this.parallaxElements,t=p(this.rootElement),n=0;n<e.length;++n){var i=p(e[n].element);(r=i).x-=(o=t).x,r.y-=o.y,e[n].updateRect(i,t)}var r,o},n._startRenderLoop=function(){var e=this.parallaxElements;window.requestAnimationFrame(function t(){for(var n=0;n<e.length;++n)e[n].render();window.requestAnimationFrame(t)})},n.add=function(e,t){if(void 0===t&&(t={}),e instanceof Element)this._addElement(e,t);else{"string"==typeof e&&(e=this.rootElement.querySelectorAll(e));for(var n=0;n<e.length;++n)this._addElement(e[n],t)}},n._addElement=function(e,t){var n=this;this._isViewportFor(e)&&(this._removeElement(e),null!=(t=this._parseElementOptions(e,t)).image&&function(e,t){var n=document.createElement("img");n.onload=function(e){t(null,e.target)},n.onerror=function(e){t(e.error)},n.src=e}(t.image,function(i,r){i||(n.parallaxElements.push(new s(e,r,t)),n._updateRects())}))},n._isViewportFor=function(e){return e!==this.rootElement&&e.closest(".parallax-background-image-viewport")===this.rootElement},n._parseElementOptions=function(e,n){return"function"==typeof n&&(n=n(e)),null==(n=t({velocity:.8,alignX:"center",renderer:d},n)).image&&(n.image=function(e){var t=window.getComputedStyle(e),n=/^url\((['"]?)(.*)\1\)$/.exec(t.backgroundImage);return null==n?null:n[2]}(e)),n.use3d=this.options.use3d,n},n.remove=function(e){if(e instanceof Element)this._removeElement(e);else{"string"==typeof e&&(e=this.rootElement.querySelectorAll(e));for(var t=0;t<e.length;++t)this._removeElement(e[t])}},n._removeElement=function(e){for(var t=this.parallaxElements,n=0;n<t.length;++n)if(this.parallaxElements[n].element===e)return t[n].dispose(),void t.splice(n,1)},e}();function p(e){var t=e.getBoundingClientRect();return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2,w:t.right-t.left,h:t.bottom-t.top}}!function(e){void 0===e&&(e="");var t=n(e);document.head.insertBefore(t,document.head.firstElementChild)}("\n.parallax-background-image-element {\n  position: relative;\n  overflow: hidden !important;\n  background: none !important;\n  background-image: none !important;\n}\n\n.parallax-background-image-element > * {\n  position: relative;\n}\n\n.parallax-background-image-viewport {\n  overflow-x: hidden !important;\n  overflow-y: scroll !important;\n  -webkit-overflow-scrolling: touch;\n}\n\n.parallax-background-image-viewport-3d {\n  perspective: 1px !important;\n  perspective-origin: center center !important;\n}"),e.ImageElementRenderer=d,e.PseudoElementRenderer=c,e.createViewport=function(e,t){return void 0===t&&(t={}),new m(e,t)}});
//# sourceMappingURL=parallax-background-image.umd.js.map
